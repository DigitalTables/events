<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DigitalTables – Gestion des tables invités</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <header>
    <div class="container">
      <div class="logo-title">
        <img src="images/Logo.jpg" alt="Logo DigitalTables" class="logo" />
        <h1>DigitalTables</h1>
      </div>
    </div>
  </header>

  <section class="hero">
    <div class="container">
      <h2>Attribuez facilement la table de vos invités</h2>
      <p>Un outil simple et rapide qui apporte une touche unique à votre événement.</p> 
    </div>
  </section>

  <!-- Déconnexion -->
  <div style="text-align:center; margin-top:1rem;">
    <button id="logout" style="display:none;">Se déconnecter</button>
  </div>

  <!-- Authentification -->
  <div id="auth" style="text-align:center; margin-top:2rem;">
    <h3>Connexion / Inscription</h3>
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Mot de passe" />
    <button id="signup">Créer un compte</button>
    <button id="login">Se connecter</button>
  </div>

  <!-- Upload CSV + images -->
  <div id="upload" style="display:none; text-align:center; margin-top:2rem;">

    <!-- Identifiant public -->
    <div style="margin-bottom:1rem;">
      <label for="username" style="display:block; font-weight:700; margin-bottom:0.25rem;">
        Choisissez un identifiant public (visible dans l’URL) :
      </label>
      <input type="text" id="username" placeholder="ex: johanna-martin-2026" />
      <div id="usernameStatus" style="margin-top:0.25rem; font-size:0.9rem;"></div>
    </div>

    <!-- Checkbox CSV privé -->
    <div style="margin-bottom:1rem;">
      <label>
        <input type="checkbox" id="privateCsv" /> CSV privé (accès via mot de passe)
      </label>
    </div>

    <!-- Champ mot de passe (affiché uniquement si privé) -->
    <div id="passwordDiv" style="display:none; margin-bottom:1rem;">
      <label for="eventPassword" style="display:block; font-weight:700; margin-bottom:0.25rem;">
        Mot de passe de l’événement :
      </label>
      <input type="password" id="eventPassword" placeholder="Mot de passe de l’événement" />
    </div>

    <h3>Uploader ton CSV et tes images</h3>
    <input type="file" id="guests" accept=".csv" /><br><br>
    <input type="file" id="images" accept="image/*" multiple /><br><br>
    <button id="send">Envoyer</button>

    <div id="publicUrl" style="margin-top:1rem; font-size:0.9rem; word-break:break-all;"></div>
  </div>

  <footer>
    <div class="container">
      <p>© 2025 DigitalTables. Tous droits réservés.</p>
    </div>
  </footer>

  <!-- Script principal -->
  <script type="module">
    import { supabase, uploadEvent } from './supabase.js';

    const authDiv = document.getElementById('auth');
    const uploadDiv = document.getElementById('upload');
    const logoutBtn = document.getElementById('logout');

    const signupBtn = document.getElementById('signup');
    const loginBtn = document.getElementById('login');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');

    const sendBtn = document.getElementById('send');
    const usernameInput = document.getElementById('username');
    const usernameStatus = document.getElementById('usernameStatus');
    const privateCsv = document.getElementById('privateCsv');
    const passwordDiv = document.getElementById('passwordDiv');
    const eventPassword = document.getElementById('eventPassword');
    const publicUrl =
